<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SUDOKU OR DIE</title>
    <style>
        :root { --blood: #600; --bright: #f00; }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; touch-action: none; }
        body { background: #000; color: #444; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; align-items: center; }

        /* EFFET VISUEL ANALOGIQUE */
        .vhs-effect { position: fixed; inset: 0; background: url('https://media.giphy.com/media/oEI9uWUPr9WUM/giphy.gif'); opacity: 0.05; pointer-events: none; z-index: 99; }
        
        #dialogue-zone { width: 100%; height: 120px; display: flex; align-items: center; justify-content: center; padding: 15px; text-align: center; border-bottom: 1px solid #111; z-index: 10; }
        #text-content { color: var(--bright); font-size: 1.1rem; font-weight: bold; text-transform: uppercase; text-shadow: 0 0 10px #000; }

        /* JEU */
        .timer-bg { width: 100%; height: 4px; background: #050505; }
        #timer-fill { width: 0%; height: 100%; background: var(--blood); transition: width 0.2s linear; }

        #grid { display: grid; grid-template-columns: repeat(9, 1fr); width: 95vw; height: 95vw; max-width: 380px; max-height: 380px; background: #111; border: 2px solid #000; margin: 15px 0; }
        .tile { background: #000; border: 0.5px solid #111; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; color: #fff; }
        .tile.fixed { color: #333; }
        .tile.selected { background: #1a0000; outline: 1px solid var(--blood); color: var(--bright); }
        .tile.error { animation: glitch 0.2s infinite; color: var(--bright); }

        @keyframes glitch { 0% { transform: translate(2px,0); } 50% { transform: translate(-2px,0); filter: hue-rotate(90deg); } 100% { transform: translate(0,0); } }

        /* CLAVIER */
        .keys { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; width: 95%; max-width: 380px; }
        .k { background: #080808; border: 1px solid #111; color: #666; padding: 18px 0; font-size: 1.3rem; border-radius: 4px; text-align: center; }
        .k:active { background: var(--blood); color: #fff; }

        /* SCREAMER */
        #screamer { position: fixed; inset: 0; background: #000; z-index: 9999; display: none; align-items: center; justify-content: center; }
        #screamer img { width: 100%; height: 100%; object-fit: cover; filter: contrast(2) brightness(0.8); }

        /* OVERLAY START */
        #init { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #start-btn { background: none; border: 1px solid var(--blood); color: var(--blood); padding: 15px 40px; font-size: 1.2rem; cursor: pointer; letter-spacing: 3px; margin-top: 30px; }
        #name-in { background: none; border: none; border-bottom: 1px solid #333; color: #fff; font-size: 1.5rem; text-align: center; outline: none; }
    </style>
</head>
<body>

<div class="vhs-effect"></div>
<div id="screamer"><img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNHJueXZueXJueXJueXJueXJueXJueXJueXJueXJueXJueXJudSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7TKv6MgQxcfPzDUY/giphy.gif"></div>

<div id="init">
    <h1 style="color:var(--blood); letter-spacing: 8px;">SUDOKU OR DIE</h1>
    <input type="text" id="name-in" placeholder="TON NOM..." maxlength="12">
    <button id="start-btn" onclick="boot()">OFFRIR MON ÂME</button>
</div>

<div id="dialogue-zone"><div id="text-content">...</div></div>
<div class="timer-bg"><div id="timer-fill"></div></div>
<div id="grid"></div>
<div class="keys">
    <script>for(let i=1; i<=9; i++) document.write(`<div class="k" onclick="hit(${i})">${i}</div>`);</script>
    <div class="k" onclick="hit(0)" style="color:var(--blood)">X</div>
</div>

<script>
    let pName = "";
    let cur = null;
    let threat = 0;
    let level = 1;
    let active = false;
    let lastAct = Date.now();
    let sol = [];

    const lines = [
        "Je sens ton souffle, [N].", "Tes fautes me nourrissent, [N].", "Le noir te regarde, [N].",
        "Tu es si lent, [N].", "Regarde derrière toi, [N].", "J'entends ton sang, [N].",
        "Tu ne sortiras pas, [N].", "Encore une erreur, [N] ?", "Ta peur est délicieuse, [N].",
        "Le vide t'appelle, [N].", "Respire tant que tu peux, [N].", "Je suis dans tes murs, [N].",
        "Abandonne, [N].", "Tu n'es rien ici, [N].", "Ton heure approche, [N].",
        "Fais un geste, [N].", "La mort est douce, [N].", "Ne crie pas, [N].",
        "Je possède ton temps, [N].", "Tu es à moi, [N]."
    ];

    function boot() {
        pName = document.getElementById('name-in').value || "Mortel";
        document.getElementById('init').style.display = 'none';
        active = true;
        setup();
        loop();
        breath();
    }

    function setup() {
        const g = document.getElementById('grid'); g.innerHTML = '';
        let base = "534678912672195348198342567859761423426853791713924856961537284287419635345286179".split('');
        sol = base;
        let fill = Math.max(78 - (level * 8), 10);
        for(let i=0; i<81; i++) {
            let t = document.createElement('div');
            t.className = 'tile';
            if(Math.random() * 81 < fill) { t.innerText = sol[i]; t.classList.add('fixed'); }
            t.onclick = () => { if(!t.classList.contains('fixed')) { if(cur) cur.classList.remove('selected'); cur = t; t.classList.add('selected'); lastAct = Date.now(); } };
            g.appendChild(t);
        }
    }

    function hit(n) {
        if(!cur || !active) return;
        lastAct = Date.now();
        let idx = Array.from(document.getElementById('grid').children).indexOf(cur);
        if(n === 0) { cur.innerText = ""; return; }
        cur.innerText = n;
        if(n != sol[idx]) {
            cur.classList.add('error');
            threat += 10;
            speak("Erreur fatale, " + pName);
            setTimeout(() => cur.classList.remove('error'), 400);
        } else {
            cur.style.color = "#0f0";
            check();
        }
    }

    function loop() {
        if(!active) return;
        threat += (0.12 * level);
        document.getElementById('timer-fill').style.width = threat + "%";

        // GESTION INACTIVITÉ (SCREAMER)
        let idle = Date.now() - lastAct;
        if(idle > 20000) { triggerScreamer(); return; }

        if(Math.random() < 0.01) {
            let l = lines[Math.floor(Math.random()*lines.length)].replace("[N]", pName);
            document.getElementById('text-content').innerText = l;
            speak(l);
        }

        if(threat >= 100) die();
        else setTimeout(loop, 100);
    }

    function breath() {
        if(!active) return;
        let b = new Audio('https://www.soundjay.com/human/sounds/human-breath-1.mp3');
        b.volume = 0.3;
        b.play().catch(()=>{});
        setTimeout(breath, Math.max(500, 2000 - (threat * 15)));
    }

    function speak(t) {
        window.speechSynthesis.cancel();
        let m = new SpeechSynthesisUtterance(t);
        m.lang = 'fr-FR'; m.pitch = 0.1; m.rate = 0.6;
        window.speechSynthesis.speak(m);
    }

    function triggerScreamer() {
        active = false;
        let s = document.getElementById('screamer');
        s.style.display = 'flex';
        let a = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-creature-roar-278.mp3');
        a.volume = 1; a.play();
        speak("JE T'AI TROUVÉ, " + pName);
        setTimeout(() => location.reload(), 3000);
    }

    function check() {
        let tiles = document.querySelectorAll('.tile');
        let win = true;
        tiles.forEach((t, i) => { if(t.innerText != sol[i]) win = false; });
        if(win) {
            level++; threat = Math.max(0, threat - 40);
            speak("Étage " + (level-1) + " fini. Tu ne tiendras pas le suivant, " + pName);
            setup();
        }
    }

    function die() {
        active = false;
        document.body.innerHTML = `<h1 style="color:red; margin-top:40vh; text-align:center;">ÂME DÉVORÉE, ${pName}</h1>`;
        speak("Ton temps est fini, " + pName);
        setTimeout(() => location.reload(), 4000);
    }
</script>
</body>
</html>
