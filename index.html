<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUDOKU OR DIE</title>
    <style>
        :root { --neon: #00f2ea; --blood: #ff4d4d; --wood: #1a0f00; }
        body { background-color: #050505; color: white; font-family: 'Courier New', monospace; overflow: hidden; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        
        /* Ambiance Table dans le noir */
        .scene { position: relative; width: 100%; max-width: 500px; padding: 20px; background: radial-gradient(circle at 50% 50%, rgba(255,240,150,0.12) 0%, rgba(0,0,0,1) 80%); }
        
        #monster-dialogue { height: 70px; text-align: center; color: var(--blood); font-style: italic; margin-bottom: 10px; font-weight: bold; font-size: 1rem; text-shadow: 2px 2px 5px #000; }
        
        /* Aide */
        .help-box { position: absolute; top: 10px; left: 10px; z-index: 10; }
        .help-btn { background: #222; color: #777; border: 1px solid #444; padding: 5px 10px; font-size: 0.7rem; cursor: pointer; }
        
        #game-board { display: grid; grid-template-columns: repeat(9, 1fr); gap: 1px; background-color: #222; border: 5px solid #111; margin: 0 auto; width: 85vw; max-width: 360px; aspect-ratio: 1; box-shadow: 0 0 80px rgba(0,0,0,1); }
        
        .tile { background-color: #f0f0f0; color: #111; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; font-weight: bold; cursor: pointer; border: 0.1px solid #ddd; }
        .tile.selected { background-color: #ccc; box-shadow: inset 0 0 10px var(--neon); }
        .tile.prefilled { background-color: #d8d8d8; color: #666; pointer-events: none; }
        
        /* Numpad style mains du joueur */
        .numpad { display: flex; justify-content: center; gap: 5px; margin-top: 20px; }
        .num-btn { background: #111; color: white; border: 1px solid #444; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        /* Barre de menace */
        .threat-level { width: 100%; height: 4px; background: #111; margin: 10px 0; border: 1px solid #222; }
        #monster-progress { width: 0%; height: 100%; background: var(--blood); box-shadow: 0 0 15px var(--blood); transition: width 0.5s linear; }

        /* Écrans Overlay */
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        #death-flash { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--blood); z-index: 200; opacity: 0.8; }
        
        .timer-info { font-size: 0.8rem; color: #555; margin-bottom: 5px; display: flex; justify-content: space-between; }
        
        .rules-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; border: 2px solid var(--neon); padding: 20px; z-index: 300; width: 80%; font-size: 0.8rem; line-height: 1.4; }
    </style>
</head>
<body>

<div id="death-flash"></div>

<div id="overlay">
    <h1 style="color:var(--blood); letter-spacing: 3px;">SUDOKU OR DIE</h1>
    <p id="main-status">Il te regarde. Ne fais pas d'erreur.</p>
    <button id="start-btn" onclick="startGame()" style="background:var(--blood); border:none; padding:15px 40px; cursor:pointer; font-weight:bold; margin-top:20px;">COMMENCER</button>
</div>

<div class="rules-modal" id="rules">
    <h2 style="color:var(--neon)">BUT DU JEU</h2>
    <p>Remplis les cases vides. <br><br><b>RÈGLE :</b> Chaque ligne, chaque colonne et chaque carré de 3x3 doit contenir les chiffres de 1 à 9 <b>SANS RÉPÉTITION</b>.<br><br>Si tu es trop lent, il te tue.</p>
    <button onclick="document.getElementById('rules').style.display='none'" style="background:white; border:none; padding:5px 10px;">J'AI COMPRIS</button>
</div>

<div class="scene">
    <div class="help-box"><button class="help-btn" onclick="document.getElementById('rules').style.display='block'">? AIDE</button></div>
    
    <div id="monster-dialogue">"Tic tac... le temps presse."</div>
    
    <div class="timer-info">
        <span>Niveau <span id="level-val">1</span>/100</span>
        <span style="color:var(--blood)">MENACE: <span id="threat-val">0</span>%</span>
    </div>
    <div class="threat-level"><div id="monster-progress"></div></div>

    <div id="game-board"></div>
    <div class="numpad" id="numpad"></div>
</div>

<script>
    let level = 1;
    let selectedTile = null;
    let solution = [];
    let monsterProgress = 0;
    let gameActive = false;
    let monsterTimer;

    const phrases = [
        "Mon père me disait : soit bon en maths, soit meurt.",
        "Tu sens cette odeur ? C'est la poudre du pistolet.",
        "J'ai tué 44 personnes ce matin. Tu es le 45ème ?",
        "Tes mains tremblent... ça m'excite.",
        "Plus tu montes, plus je deviens rapide.",
        "Regarde l'heure. C'est presque fini pour toi."
    ];

    function startGame() {
        document.getElementById('overlay').style.display = 'none';
        gameActive = true;
        initBoardOnce();
        loadLevel();
    }

    function initBoardOnce() {
        const board = document.getElementById("game-board");
        board.innerHTML = "";
        for (let i = 0; i < 81; i++) {
            let tile = document.createElement("div");
            tile.id = Math.floor(i/9) + "-" + (i%9);
            tile.classList.add("tile");
            tile.onclick = function() {
                if (selectedTile) selectedTile.classList.remove("selected");
                selectedTile = this;
                selectedTile.classList.add("selected");
            };
            board.appendChild(tile);
        }
        const numpad = document.getElementById("numpad");
        numpad.innerHTML = "";
        for (let i = 1; i <= 9; i++) {
            let btn = document.createElement("button");
            btn.innerText = i; btn.classList.add("num-btn");
            btn.onclick = () => {
                if (selectedTile && !selectedTile.classList.contains("prefilled")) {
                    selectedTile.innerText = i;
                    checkWin();
                }
            };
            numpad.appendChild(btn);
        }
    }

    function loadLevel() {
        document.getElementById("level-val").innerText = level;
        monsterProgress = 0;
        updateMonsterUI();
        
        // Grille de base simplifiée
        let base = ["534678912", "672195348", "198342567", "859761423", "426853791", "713924856", "961537284", "287419635", "345286179"];
        solution = base.map(row => row.split(''));

        for (let r = 0; r < 9; r++) {
            for (let c = 0; c < 9; c++) {
                let tile = document.getElementById(r + "-" + c);
                tile.innerText = ""; tile.classList.remove("prefilled");
                
                // PROGRESSION : Niveau 1 = 80 cases remplies. Niveau 100 = 15 cases remplies.
                let fillRate = Math.max(0.98 - (level * 0.01), 0.2); 
                if (Math.random() < fillRate) {
                    tile.innerText = solution[r][c];
                    tile.classList.add("prefilled");
                }
            }
        }

        clearInterval(monsterTimer);
        // Le monstre va de plus en plus vite
        let tickSpeed = Math.max(1500 - (level * 20), 300);
        monsterTimer = setInterval(() => {
            monsterProgress += 1.5;
            updateMonsterUI();
            if(monsterProgress >= 100) die();
            if(Math.random() < 0.1) talk();
        }, tickSpeed);
    }

    function updateMonsterUI() {
        document.getElementById("monster-progress").style.width = monsterProgress + "%";
        document.getElementById("threat-val").innerText = Math.floor(monsterProgress);
    }

    function talk() {
        document.getElementById("monster-dialogue").innerText = `"${phrases[Math.floor(Math.random()*phrases.length)]}"`;
    }

    function checkWin() {
        let isCorrect = true;
        for (let r = 0; r < 9; r++) {
            for (let c = 0; c < 9; c++) {
                if (document.getElementById(r + "-" + c).innerText != solution[r][c]) isCorrect = false;
            }
        }
        if (isCorrect) {
            level++;
            if(level > 100) {
                alert("LE MONSTRE SE SUICIDE. TU AS GAGNÉ.");
                location.reload();
            } else {
                loadLevel();
            }
        }
    }

    function die() {
        gameActive = false;
        clearInterval(monsterTimer);
        document.getElementById("death-flash").style.display = "block"; // Animation flash sang
        setTimeout(() => {
            document.getElementById("overlay").style.display = "flex";
            document.getElementById("main-status").innerHTML = "<span style='color:red; font-size:2rem;'>LE MONSTRE T'A TUÉ</span><br>Trop lent. Ton sang coule sur la table.";
            document.getElementById("start-btn").innerText = "RESSUSCITER";
        }, 100);
    }
</script>
</body>
</html>
